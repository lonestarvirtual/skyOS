<script async src="https://www.googletagmanager.com/gtag/js?id=<%= Setting.google_analytics_id %>"></script>

<script>
  this.dataLayer = this.dataLayer || [];

  this.gtag = (function(_this) {
      return function() {
          return dataLayer.push(arguments);
      };
  })(this);

  this.gtag('js', new Date());

  document.addEventListener('turbolinks:load', (function(_this) {
      return function(event) {
          return _this.gtag('config', '<%= Setting.google_analytics_id %>', {
              <% if Setting.google_analytics_anonymous? %>
              anonymize_ip: true,
              <% end %>
              page_location: event.data.url
          });
      };
  })(this));
</script>
